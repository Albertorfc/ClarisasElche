<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>{{ title }}</title>
  <meta name="description" content="{{ description or 'Monasterio de Santa Clara. Siguiendo a Cristo en Elche desde 1516.' }}">

  {# ==========================================================
     CONFIGURACIÓN GENERAL
     ========================================================== #}

  {# Dominio del sitio (si existe metadata.url se usa; si no, fallback) #}
  {% set siteUrl = metadata.url or "https://www.clarisaselche.es" %}
  {% set siteUrl = siteUrl.rstrip('/') %}

  {# ==========================================================
     DETECCIÓN DE CONTEXTO
     ========================================================== #}

  {# Consideramos "article" si es una noticia #}
  {% set isArticle =
      page.data.layout == 'noticia.njk'
      or page.data.excerpt is defined
      or page.data.image is defined
  %}

  {# ==========================================================
     TÍTULO Y DESCRIPCIÓN
     ========================================================== #}

  {% set ogTitle = page.data.title or title or "Hermanas Clarisas de Elche" %}
  {% set ogDescription =
      page.data.excerpt
      or page.data.description
      or description
      or "Monasterio de Santa Clara. Siguiendo a Cristo en Elche desde 1516."
  %}

  {# ==========================================================
     SELECCIÓN DE IMAGEN (ROBUSTA)
     ========================================================== #}

  {# Intentamos localizar la imagen de la noticia #}
  {% set candidateImages = [
    page.data.image,
    image,
    page.data.featuredImage,
    page.data.thumbnail
  ] %}

  {% set chosenImage = none %}
  {% for img in candidateImages %}
    {% if img %}
      {% set chosenImage = img %}
      {% break %}
    {% endif %}
  {% endfor %}

  {# Si no aparece, intentamos buscarla en la colección de noticias #}
  {% if not chosenImage and collections.noticias %}
    {% for post in collections.noticias %}
      {% if post.url == page.url and post.data.image %}
        {% set chosenImage = post.data.image %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {# Fallback final a la imagen de la home #}
  {% if not chosenImage %}
    {% set chosenImage = '/imagenes/og-home.jpg' %}
  {% endif %}

  {# Convertimos la imagen a URL absoluta si es relativa #}
  {% if '://' in chosenImage %}
    {% set ogImage = chosenImage %}
  {% else %}
    {% set ogImage = siteUrl + (chosenImage.startswith('/') ? chosenImage : '/' + chosenImage) %}
  {% endif %}

  {# URL absoluta de la página #}
  {% set pageUrl = siteUrl + page.url %}

  {# ==========================================================
     OPEN GRAPH / WHATSAPP / FACEBOOK
     ========================================================== #}

  <meta property="og:type" content="{{ 'article' if isArticle else 'website' }}" />
  <meta property="og:locale" content="es_ES" />
  <meta property="og:site_name" content="Hermanas Clarisas de Elche" />

  <meta property="og:title" content="{{ ogTitle }}" />
  <meta property="og:description" content="{{ ogDescription }}" />
  <meta property="og:url" content="{{ pageUrl }}" />

  <meta property="og:image" content="{{ ogImage }}" />
  <meta property="og:image:secure_url" content="{{ ogImage }}" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  {# ==========================================================
     TWITTER CARDS (WhatsApp también las usa)
     ========================================================== #}

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ ogTitle }}" />
  <meta name="twitter:description" content="{{ ogDescription }}" />
  <meta name="twitter:image" content="{{ ogImage }}" />

  {# ==========================================================
     RECURSOS
     ========================================================== #}

  <link rel="icon" href="/favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="/css/style.css" />
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
</head>

<body>

<!-- Cabecera común -->
<header class="hero-header">
  <img src="/imagenes/noticias/20250811.png" alt="Encabezado" class="hero-img" />
  <div class="hero-texto">
    <h1>Hermanas Clarisas de Elche</h1>
    <p>Monasterio de Santa Clara</p>
    <p>Siguiendo a Cristo en Elche desde 1516</p>
  </div>
</header>

<!-- Menú común -->
<nav>
  <div class="nav-container">
    <button class="menu-toggle">☰</button>
    {% include "nav.njk" %}
  </div>
</nav>

<!-- Contenido de cada página -->
<main>
  <div class="columnas-balanceadas">
    {% block content %}
      {{ content | safe }}
    {% endblock %}
  </div>
</main>

<footer>
  <div class="footer-links">
    <a href="https://www.instagram.com/deliciasdesantaclaraelche/" target="_blank" rel="noopener">
      <img src="/imagenes/logo-IG.png" alt="Instagram" width="32" height="32">
      <span class="tooltip">@deliciasdesantaclaraelche</span>
    </a>

    <a href="https://www.vatican.va/" target="_blank" rel="noopener">
      <img src="/imagenes/LogoSantaSede.png" alt="Santa Sede" width="32" height="32">
      <span class="tooltip">Santa Sede</span>
    </a>

    <a href="https://www.diocesisoa.org/" target="_blank" rel="noopener">
      <img src="/imagenes/logo-DOA-blanco.png" alt="Diócesis Orihuela-Alicante" width="32" height="32">
      <span class="tooltip">Diócesis Orihuela-Alicante</span>
    </a>

    <a href="https://basilicasantamariaelche.es/" target="_blank" rel="noopener">
      <img src="/imagenes/logo-STAMARIA.png" alt="Basílica Santa María Elche" width="32" height="32">
      <span class="tooltip">Basílica Santa María Elche</span>
    </a>
  </div>

  <p>&copy; 2025 Hermanas Clarisas de Elche – Convento de Santa Clara</p>
</footer>

<!-- Script menú hamburguesa -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const toggle = document.querySelector('.menu-toggle');
  const nav = document.querySelector('.nav-links');

  if (toggle && nav) {
    toggle.addEventListener('click', () => {
      nav.classList.toggle('show');
    });
  }
});
</script>

<!-- AOS Scripts -->
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('p, h2, img').forEach(el => {
    if (!el.hasAttribute('data-aos')) {
      el.setAttribute('data-aos', 'fade-up');
    }
  });

  AOS.init({
    duration: 800,
    once: true
  });
});
</script>

</body>
</html>
